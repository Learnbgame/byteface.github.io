(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this;initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}}(name,prop[name]):prop[name]}function Class(){if(!initializing&&this.init)this.init.apply(this,arguments)}Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class}})();var Particle=Class.extend({x:0,y:0,width:0,height:0,rotation:0,xMouse:0,yMouse:0,vx:0,vy:0,damp:.9,bounce:-.5,grav:0,maxSpeed:null,wander:0,_k:.2,_bounds:null,_draggable:false,edges:"bounce",_drag:false,_oldx:null,_oldy:null,_turnToPath:false,_springToMouse:false,_mouseK:.2,gravToMouse:false,gravMouseForce:5e3,repelMouse:false,repelMouseMinDist:100,repelMouseK:.2,_springPoints:[],_gravPoints:[],_repelPoints:[],_springParticles:[],_gravParticles:[],_repelParticles:[],fixedPointX:0,fixedPointY:0,fixedPoint:false,fixedPointForce:5e3,init:function(){this._bounds={};this.setBounds({xMin:0,yMin:0,yMax:800,xMax:800});this.maxSpeed=Number.MAX_VALUE;this._springPoints=[];this._gravPoints=[];this._repelPoints=[];this._springParticles=[];this._gravParticles=[];this._repelParticles=[]},setBounds:function(oBounds){this._bounds.top=oBounds.yMin;this._bounds.bottom=oBounds.yMax;this._bounds.left=oBounds.xMin;this._bounds.right=oBounds.xMax},draggable:function(){return this._draggable},turnToPath:function(bTurn){this._turn=bTurn},update:function(){var dx,dy,distSQ,dist,force,tx,ty,point,particle,k,minDist;if(this._drag){this.vx=this.x-this._oldx;this.vy=this.y-this._oldy;this._oldx=this.x;this._oldy=this.y}else{if(this._springToMouse){this.vx+=(this.xMouse-this.x)*this._mouseK;this.vy+=(this.yMouse-this.y)*this._mouseK}if(this.gravToMouse){dx=this.xMouse-this.x;dy=this.yMouse-this.y;distSQ=dx*dx+dy*dy;dist=Math.sqrt(distSQ);force=this.gravMouseForce/distSQ;this.vx+=force*dx/dist;this.vy+=force*dy/dist}if(this.repelMouse){dx=this.xMouse-this.x;dy=this.yMouse-this.y;dist=Math.sqrt(dx*dx+dy*dy);if(dist<this.repelMouseMinDist){tx=this.xMouse-this.repelMouseMinDist*dx/dist;ty=this.yMouse-this.repelMouseMinDist*dy/dist;this.vx+=(tx-this.x)*this.repelMouseK;this.vy+=(ty-this.y)*this.repelMouseK}}for(var sp=0;sp<this._springPoints.length;sp++){point=this._springPoints[sp];this.vx+=(point.x-this.x)*point.k;this.vy+=(point.y-this.y)*point.k}for(var gp=0;gp<this._gravPoints.length;gp++){point=this._gravPoints[gp];dx=point.x-this.x;dy=point.y-this.y;distSQ=dx*dx+dy*dy;dist=Math.sqrt(distSQ);force=point.force/distSQ;this.vx+=force*dx/dist;this.vy+=force*dy/dist}for(var rp=0;rp<this._repelPoints.length;rp++){point=this._repelPoints[rp];dx=point.x-this.x;dy=point.y-this.y;dist=Math.sqrt(dx*dx+dy*dy);if(dist<point.minDist){tx=point.x-point.minDist*dx/dist;ty=point.y-point.minDist*dy/dist;this.vx+=(tx-this.x)*point.k;this.vy+=(ty-this.y)*point.k}}for(var sc=0;sc<this._springParticles.length;sc++){particle=this._springParticles[sc].particle;k=this._springParticles[sc].k;this.vx+=(particle.x-this.x)*k;this.vy+=(particle.y-this.y)*k}for(var gc=0;gc<this._gravParticles.length;gc++){particle=this._gravParticles[gc].particle;dx=particle.x-this.x;dy=particle.y-this.y;distSQ=dx*dx+dy*dy;dist=Math.sqrt(distSQ);force=this._gravParticles[gc].force/distSQ;this.vx+=force*dx/dist;this.vy+=force*dy/dist}for(var rc=0;rc<this._repelParticles.length;rc++){particle=this._repelParticles[rc].particle;minDist=this._repelParticles[rc].minDist;k=this._repelParticles[rc].k;dx=particle.x-this.x;dy=particle.y-this.y;dist=Math.sqrt(dx*dx+dy*dy);if(dist<minDist){tx=particle.x-minDist*dx/dist;ty=particle.y-minDist*dy/dist;this.vx+=(tx-this.x)*k;this.vy+=(ty-this.y)*k}}this.vx+=Math.random()*this.wander-this.wander/2;this.vy+=Math.random()*this.wander-this.wander/2;this.vy+=this.grav;this.vx*=this.damp;this.vy*=this.damp;var speed=Math.sqrt(this.vx*this.vx+this.vy*this.vy);if(speed>this.maxSpeed){this.vx=this.maxSpeed*this.vx/speed;this.vy=this.maxSpeed*this.vy/speed}if(this._turn){this.rotation=Math.atan2(this.vy,this.vx)}this.x+=this.vx;this.y+=this.vy;if(this.edges==="wrap"){if(this.x>this._bounds.right+this.width/2){this.x=this._bounds.left-this.width/2}else if(this.x<this._bounds.left-this.width/2){this.x=this._bounds.right+this.width/2}if(this.y>this._bounds.bottom+this.height/2){this.y=this._bounds.top-this.height/2}else if(this.y<this._bounds.top-this.height/2){this.y=this._bounds.bottom+this.height/2}}else if(this.edges==="bounce"){if(this.x>this._bounds.right-this.width/2){this.x=this._bounds.right-this.width/2;this.vx*=this.bounce}else if(this.x<this._bounds.left+this.width/2){this.x=this._bounds.left+this.width/2;this.vx*=this.bounce}if(this.y>this._bounds.bottom-this.height/2){this.y=this._bounds.bottom-this.height/2;this.vy*=this.bounce}else if(this.y<this._bounds.top+this.height/2){this.y=this._bounds.top+this.height/2;this.vy*=this.bounce}}else if(this.edges==="remove"){if(this.x>this._bounds.right+this.width/2||this.x<this._bounds.left-this.width/2||this.y>this._bounds.bottom+this.height/2||this.y<this._bounds.top-this.height/2){}}}if(isNaN(this.x)){this.x=this.y=this.vx=this.vy=0}},setGravToMouse:function(pcanvas,bGrav,force){var self=this;pcanvas.onmousemove=function(event){this.xMouse=event.pageX-pcanvas.offsetLeft;this.yMouse=event.pageY-pcanvas.offsetTop};if(bGrav){if(!force){var force=1e3}this.gravMouseForce=force;this.gravToMouse=true}else{this.gravToMouse=false}},springToMouse:function(bSpring,force){if(bSpring){if(!force){var force=.1}this._mouseK=force;this._springToMouse=true}else{this._springToMouse=false}},onClick:function(event){this.xMouse=event.pageX;this.yMouse=event.pageY},setRepelMouse:function(pcanvas,bRepel,force,minDist){pcanvas.addEventListener("mousemove",this.onClick.bind(this),false);if(bRepel){if(!force){var force=.1}if(!minDist){var minDist=100}this.repelMouseK=force;this.repelMouseMinDist=minDist;this.repelMouse=true}else{this.repelMouse=false}},addSpringPoint:function(x,y,force){if(!force){var force=.1}this._springPoints.push({x:x,y:y,k:force});return this._springPoints.length-1},addGravPoint:function(x,y,force){if(!force){var force=1e3}this._gravPoints.push({x:x,y:y,force:force});return this._gravPoints.length-1},addRepelPoint:function(x,y,force,minDist){if(!force){var force=.1}if(!minDist){var minDist=100}this._repelPoints.push({x:x,y:y,k:force,minDist:minDist});return this._repelPoints.length-1},addSpringParticle:function(particle,force){if(!force){var force=.1}this._springParticles.push({particle:particle,k:force});return this._springParticles.length-1},addGravParticle:function(particle,force){if(!force){var force=1e3}this._gravParticles.push({particle:particle,force:force});return this._gravParticles.length-1},addRepelParticle:function(particle,force,minDist){if(!force){var force=.1}if(!minDist){var minDist=100}this._repelParticles.push({particle:particle,k:force,minDist:minDist});return this._repelParticles.length-1},removeSpringPoint:function(index){this._springPoints.splice(index,1)},removeGravPoint:function(index){this._gravPoints.splice(index,1)},removeRepelPoint:function(index){this._repelPoints.splice(index,1)},removeSpringParticles:function(index){this._springParticles.splice(index,1)},removeGravParticles:function(index){this._gravParticles.splice(index,1)},removeRepelParticle:function(index){this._repelParticles.splice(index,1)},clearSpringPoints:function(){this._springPoints=[]},clearGravPoints:function(){this._gravPoints=[]},clearRepelPoints:function(){this._repelPoints=[]},clearSpringParticles:function(){this._springParticles=[]},clearGravParticles:function(){this._gravParticles=[]},clearRepelParticles:function(){this._repelParticles=[]}});